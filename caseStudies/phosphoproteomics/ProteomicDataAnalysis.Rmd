---
title: "Proteomic Data Analysis and Visualization"
author: "Alex Sanchez"
date: "October 30, 2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

output:
  html_document:
    theme: united
    toc: yes
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, cache=FALSE, 
                      echo=TRUE, warning=FALSE, message=FALSE, results ='markup')
options(warn=-1, width=100)
```

```{r installation, echo=FALSE}
installifnot <- function (packageName){
 if (!(require(packageName, character.only=TRUE))) {
    install.packages(packageName)
  }else{
    detach(paste ("package", packageName, sep=":"), character.only=TRUE)
  } 
}
installifnot("knitr")
installifnot("readxl")
installifnot("writexl")
installifnot("tidyverse")
```

# Introduction

A phosphoproteomics experiment has been performed as described in figure 1.

![A phosphoproteomics experiment](phosphoproteomics.png)

- The experiment has analyzed (3 + 3) PDX models of two different subtypes using Phosphopeptide enriched samples. 
- LC-MS analysis of 2 technical duplicates
- The results set consisted of *Normalized abundances of MS signals for  ca. 1400 phosphopeptides*
- Goal of the analysis: **search phosphopeptides that allow differentiation of the two tumor groups*
- This should be made with both Statistical Analysis and visualization.
- Data have been provided as an excel file: `TIO2+PTYR-human-MSS+MSIvsPD.XLSX`
- Groups are defined as:
    + MSS group: Samples M1, M5 and T49, 
    + PD group: Samples M42, M43 and M64
with two technical replicates for each sample
- The first column, “SequenceModification” contains abundance values for the distinct phosphopetides. Other columns can be omitted.

# Data exploration

```{r}
require(readxl)
phData <- read_excel(path= "TIO2+PTYR-human-MSS+MSIvsPD.XLSX")
targets <- read_excel(path= "TIO2+PTYR-human-MSS+MSIvsPD.XLSX", sheet=2)
targets
```

A first look at file

```{r}
library(tidyverse)
glimpse(phData)
head(phData)
abundances <- as.matrix(phData[,5:16])
head(abundances)
```

It is convenient to have short-but-meaningful rownames, so accession column might be used
It is not however possible because rownames cannot have duplicates.
This is solved with `make.names` function

```{r}
newRownames <- make.names(phData$Accession, unique=TRUE)
rownames(abundances) <- newRownames
```

It is clear that abundance values are very heterogeneous:

```{r}
summary(abundances)
```

This is better seen in a boxplot.
In order to draw a multiple boxplot the data matrix has to be reshaped into a data frame with at least one numerical variable and one or more categorical variables.

```{r}
dat <- stack(as.data.frame(abundances))
head(dat)
```

In order to use the information on groups ("covariates") we must extract it from the column names.

(**Notice that they have been prepared specifically to contain this information!!!**)

```{r}
library(stringr)
covs <- str_split(dat$ind, "_", simplify=FALSE)
colnames(covs<- c("Sample", "Replicate", "Group"))
dat2 <- cbind(dat,covs)
```

```{r}
library(ggplot2)

ggplot(dat) + 
  geom_boxplot(aes(x = ind, y = values))
```

The plot suggests that we should transform data. A quick-and-dirty approach is to take logarithms of the data to which we have added 1 to avoid problems with zeroes.

```{r}
dat1 <- dat+1
logDat <- log10(dat1)
```






